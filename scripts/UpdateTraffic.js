//AJAX
let trafficIndexFlag;
let showIndexFlag;
// let trafficJSON = require('fs');
function setIndexFlag() {
  if (localStorage.getItem("trafficIndexFlag")) {
    trafficIndexFlag = localStorage.getItem("trafficIndexFlag");
  } else {
    trafficIndexFlag = 0;
  }
  if (localStorage.getItem("showIndexFlag")) {
    showIndexFlag = localStorage.getItem("showIndexFlag");
  } else {
    showIndexFlag = 0;
  }
}

async function updateTraffic() {
  setIndexFlag();
  let url = "http://192.168.50.129:8080/data";
  return await $.getJSON(url, {
    'index': trafficIndexFlag
  })
};

function updateCard(data) {
  $("#malware-traffic-sum").text(data.abnormal_data_length);
  $("#normal-traffic-sum").text(data.normal_data_length);
}

function updateFlag(data) {
  trafficIndexFlag = data.abnormal_data_length;
  localStorage.setItem("trafficIndexFlag", trafficIndexFlag);
}

function updateDonutChart(data) {
  donutChart.config.data.datasets[0].data[0] = data.abnormal_data_length;
  donutChart.config.data.datasets[0].data[1] = data.normal_data_length;
  donutChart.update();
}

function setListToBeShown(data){
  data.detailed_info.forEach(detailedInfo => {
    let flag = parseInt(localStorage.getItem("showIndexFlag"));
    localStorage.setItem(`show[${flag}]`, JSON.stringify(detailedInfo))
    flag = (flag + 1) % 10;
    localStorage.setItem("showIndexFlag", flag);
  });
}